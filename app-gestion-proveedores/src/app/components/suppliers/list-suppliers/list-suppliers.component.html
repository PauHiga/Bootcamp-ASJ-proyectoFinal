<section class="container pt-2">

  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{title}}</li>
    </ol>
  </nav>
  <h1>{{title}}</h1>
  
  <div class="container" *ngIf="(seeDeleted || suppliers.length>0)">
    <div class="d-flex justify-content-between">
      <button class="btn btn-primary my-2" routerLink="/proveedores/formulario-proveedores">Create a Supplier</button>
      <div class="my-3">
        <label for="">Search code / business name</label>
        <input type="text" class="mx-3" name="search" [(ngModel)]="search">
      </div>
      <button class="btn btn-outline-secondary my-2" (click)="toggleShowDeleted()">{{showDeletedButtonMessage}}</button>
    </div>
    <table class="table table-striped ">
      <thead>
        <tr>
          <th scope="col-2"></th>
          <th (click)="setSortByCode('code')" scope="col-2">Code <span class="material-icons vertical-align">arrow_drop_down</span></th>
          <th (click)="setSortByCode('business_name')" scope="col-2">Business name <span class="material-icons vertical-align">arrow_drop_down</span></th>
          <th (click)="setSortByCountry()" scope="col-2">Country <span class="material-icons vertical-align">arrow_drop_down</span></th>
          <th scope="col-2">Contact</th>
          <th scope="col-2">Representative</th>
          <th colspan="3" scope="col" class="text-center">Options</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let supplier of suppliers | filterDeleted: showDeleted | filterSuppliers: search | orderByCountry: sortByCountryDesc | orderBy: sortBy : sortByDesc">
          <td><div class="imgContainer"><img src="{{supplier.url_logo}}" alt="{{supplier.business_name}}" height=80 (error)="imageError($event)"></div></td>
          <th scope="row">{{supplier.code}}</th>
          <td>{{supplier.business_name}}</td>
          <td>{{supplier.address.locality.province.country.name}} - {{supplier.address.locality.province.name}}</td>
          <td>
            <ul>
              <li>E-mail: {{supplier.email}}</li>
              <li>Phone: {{supplier.phone}}</li>
              <li *ngIf="supplier.web">Web: {{supplier.web}}</li>
            </ul>  
          </td>
          <td>{{supplier.contact?.last_name}}, {{supplier.contact?.first_name}}</td>
          <td (click)="editSupplier(supplier.id)"><img src="/assets/icons/pencil-square.svg" alt="editar proveedor" width="25" height="25"></td>
          <td *ngIf="!showDeleted" (click)="logicalDeleteSupplier(supplier.id)"><img src="/assets/icons/trash.svg" alt="borrar proveedor" width="25" height="25"></td>
          <td (click)="getASupplier(supplier.id)" data-bs-toggle="modal" data-bs-target="#detalleProductoModal"><img src="/assets/icons/info-circle.svg" alt="ver detalle del proveedor" width="25" height="25"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="container d-flex flex-column justify-content-center align-items-center empty-table" *ngIf="(!seeDeleted && suppliers.length<=0)">
    <p>There are no registered active suppliers</p>
    <p>Start <b>adding a new supplier</b></p>
    <button class="btn btn-primary" routerLink="/proveedores/formulario-proveedores">Add a new supplier</button>
  </div>
</section>

  <!-- Modal -->
  <div class="modal fade" id="detalleProductoModal" tabindex="-1" role="dialog" aria-labelledby="detalleProductoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title w-100 text-center" id="detalleProductoModalLabel">{{selectedSupplier?.business_name}}</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="container">
            <div class="d-flex justify-content-center ">
              <div *ngIf="selectedSupplier?.url_logo != ''" class="w-50">
                <div class="imgContainerModal">
                  <img src="{{selectedSupplier?.url_logo}}" alt="{{selectedSupplier?.url_logo}}">
                </div>
              </div>
              <div class="w-75">
                <h5>General information</h5>
                <table class="table">
                  <tr>
                    <td class="col-sm-5">
                      Supplier ID:
                    </td>
                    <td>
                      {{selectedSupplier?.id}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Code:
                    </td>
                    <td>
                      {{selectedSupplier?.code}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Business name:
                    </td>
                    <td>
                      {{selectedSupplier?.business_name}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Sector:
                    </td>
                    <td>
                      {{selectedSupplier?.sector}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Cuit:
                    </td>
                    <td>
                      {{selectedSupplier?.cuit}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      VAT condition:
                    </td>
                    <td>
                      {{selectedSupplier?.vat_condition}}
                    </td>
                  </tr>
                </table>
                <hr>
                <h6>Address</h6>
                <table class="table">
                  <tr>
                    <td>
                      Street:
                    </td>
                    <td>
                      {{selectedSupplier?.address?.street}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Number:
                    </td>
                    <td>
                      {{selectedSupplier?.address?.number}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Postal code:
                    </td>
                    <td>
                      {{selectedSupplier?.address?.postal_code}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Country:
                    </td>
                    <td>
                      {{selectedSupplier?.address?.country}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Province:
                    </td>
                    <td>
                      {{selectedSupplier?.address?.province}}
                    </td>
                  </tr>
                  <tr>
                    <td class="col-sm-5">
                      Locality:
                    </td>
                    <td>
                      {{selectedSupplier?.address?.locality}}
                    </td>
                  </tr>
                </table>
                <hr>
                <h6>Contact</h6>
                <table class="table">
                  <tr>
                    <td class="col-sm-5">
                      Contact:
                    </td>
                    <td>
                      {{selectedSupplier?.contact?.last_name}}, {{selectedSupplier?.contact?.first_name}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Email:
                    </td>
                    <td>
                      {{selectedSupplier?.contact?.email}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Phone:
                    </td>
                    <td>
                      {{selectedSupplier?.contact?.phone}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      Role:
                    </td>
                    <td>
                      {{selectedSupplier?.contact?.role}}
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" (click)="editSupplier(selectedSupplier?.id)" class="btn btn-primary" data-bs-dismiss="modal">Edit</button>
        </div>
      </div>
    </div>
  </div>
  